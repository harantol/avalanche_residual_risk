close all
clear all
filename = 'MNT_Argentiere_MdG_10m_ll.tif';
[alti, cmap, R] = geotiffread(filename);
[aspect, slope, gradN, gradE] = gradientm(alti, cmap);


% [photo, cmap_opt, R_opt] = geotiffread('\\NAS-60-9F-19\backup\RADAR_DATA\OPTIQUE\onc_50cm_Argentiere.tif');
%% PARAMETRES
% BRA
danger_level = 3;%[1-5]
alti_thrshld = 1500;

BRA_map = danger_level*ones(size(alti));
BRA_map(alti<alti_thrshld)=danger_level-1;

% FR
sec_nord = 45;
moitie_nord = 90;

inclinaison = slope;
%inclinaison_corrigee =

fr_inclinaison = ones(size(inclinaison));
fr_inclinaison(inclinaison>=36 & inclinaison<39) = 2;
fr_inclinaison(inclinaison>=34 & inclinaison<36) = 3;
fr_inclinaison(inclinaison>=30 & inclinaison<34) = 4;

orientation = atan2d(gradE,-gradN);%/!\ signe !

fr_orientation = ones(size(orientation));
fr_orientation(abs(orientation)>45)=2;
fr_orientation(orientation>67.5 | orientation<-112.5)=3;

fr_frequentation = 1;

fr_groupe = 2;

% RR
RR = 2.^BRA_map ./ (fr_inclinaison.*fr_orientation*fr_frequentation*fr_groupe);
RR(inclinaison<30) = 0;
%%
figure1 = figure('Colormap',...
    [0 0 0.560784339904785;0 1 0;0.000988142332062125 0.999604761600494 0;0.00197628466412425 0.999209463596344 0;0.00296442699618638 0.998814225196838 0;0.0039525693282485 0.998418986797333 0;0.00494071142747998 0.998023688793182 0;0.00592885399237275 0.997628450393677 0;0.00691699609160423 0.997233211994171 0;0.007905138656497 0.996837913990021 0;0.00889328122138977 0.996442675590515 0;0.00988142285495996 0.99604743719101 0;0.0108695654198527 0.995652198791504 0;0.0118577079847455 0.995256900787354 0;0.0128458496183157 0.994861662387848 0;0.0138339921832085 0.994466423988342 0;0.0148221347481012 0.994071125984192 0;0.015810277312994 0.993675887584686 0;0.0167984198778868 0.993280649185181 0;0.0177865624427795 0.99288535118103 0;0.0187747031450272 0.992490112781525 0;0.0197628457099199 0.992094874382019 0;0.0207509882748127 0.991699576377869 0;0.0217391308397055 0.991304337978363 0;0.0227272734045982 0.990909099578857 0;0.023715415969491 0.990513801574707 0;0.0247035585343838 0.990118563175201 0;0.0256916992366314 0.989723324775696 0;0.0266798418015242 0.989328026771545 0;0.0276679843664169 0.98893278837204 0;0.0286561269313097 0.988537549972534 0;0.0296442694962025 0.988142251968384 0;0.0306324120610952 0.987747013568878 0;0.031620554625988 0.987351775169373 0;0.0326086953282356 0.986956477165222 0;0.0335968397557735 0.986561238765717 0;0.0345849804580212 0.986166000366211 0;0.0355731248855591 0.985770761966705 0;0.0365612655878067 0.985375463962555 0;0.0375494062900543 0.984980225563049 0;0.0385375507175922 0.984584987163544 0;0.0395256914198399 0.984189689159393 0;0.0405138358473778 0.983794450759888 0;0.0415019765496254 0.983399212360382 0;0.0424901209771633 0.983003914356232 0;0.0434782616794109 0.982608675956726 0;0.234782606363297 0.906086921691895 0;0.426086962223053 0.829565227031708 0;0.617391288280487 0.753043472766876 0;0.808695673942566 0.676521778106689 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0.600000023841858 0;1 0 0]);
imagesc(RR),axis equal,
caxis([0 1.3]);
colorbar
tt = sprintf('Risque résiduel. FR groupe:%d, FR frequentation:%d',fr_groupe,fr_frequentation);
title(tt);
%%
figure,imagesc(inclinaison),colormap jet,colorbar;axis equal,title('Pente (°)');
